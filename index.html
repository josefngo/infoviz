<!DOCTYPE html>
<html>

<head>
  <title>Climate Change Visualization</title>
  <!-- Styles -->
  <link href="stylesheet.css" rel="stylesheet" />
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet" integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
</head>

<body class="bg-light">
  <nav class="navbar bg-dark navbar-expand-lg">
    <div class="container-fluid">
      <a class="navbar-brand" href="." style="color: white">Climate Change Visualization</a>
    </div>
  </nav>
  <div class="container-fluid bg-light">
    <div class="row">
      <div id="mapContainer" class="col-8">
        <div class="centered-flex">
          <div id="canvasMap"></div>
          <input type="range" value="0" class="slider" id="yearSlider" />
          <button id="play-button" class="btn btn-outline-dark shadow-none">Pause</button>
        </div>
      </div>
      <div id="chartContainer" class="col-4 centered-flex">
        <div class="row" style="margin-top: 10%">
          <div id="co2Graph" class="col-12">
            <h4>Global Temperature vs CO2 Emissions</h4>
            <canvas id="temperatureCO2Chart" width="400" height="200"></canvas>
            <script type="module" src="global_chart.js"></script>
          </div>
          <div id="radiusChart" class="col-12" style="margin-top: 5%"></div>
        </div>
      </div>
    </div>
  </div>
  <div class="tooltip" style="opacity: 0"></div>
</body>
<script src="d3.js"></script>
<script src="https://d3js.org/d3-geo-projection.v3.min.js"></script>
<script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js" integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz" crossorigin="anonymous"></script>
<script type="module" src="./index.js"></script>
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
  let temperatureData = [];
  let globalTemp = [];
  let emissionData = [];
  let globalEmmisions = [];

  d3.csv("data/combined_temperature_with_delta.csv").then(data => {
    temperatureData = data.map(d => ({
      Country: d.Country,
      Year: +d.Year,
      Annual_Mean: d.Annual_Mean,
      delta: d.delta
    }));
    console.log("Temperature data loaded:", temperatureData); // Log the data to the console
    globalTemp = calcGlobalTemp(temperatureData);
    //console.log("Global Temp data loaded:", globalTemp); // Log the data to the console  
    // updateMapColors(d3.select("#year-slider").property("value"));
  }).catch(error => {
    console.error("Error loading the temperature data: ", error);
  });

  d3.csv("data/fossil-fuel-co2-emissions-by-nation.csv").then(data => {
    emissionsData = data.map(d => ({
      Country: d.Country.toUpperCase(),
      Year: +d.Year,
      Total: +d.Total
    }));
    console.log("Carbon data loaded:", emissionsData); // Log the data to the console
    globalEmmisions = calcGlobalEmission(emissionsData);
    //console.log("Global Carbon data loaded:", globalEmmisions); // Log the data to the console
  }).catch(error => {
    console.error("Error loading the carbon data: ", error);
  });

  // Calculate the yearly mean global temperature
  function calcGlobalTemp(data) {
    const groupedByYear = d3.group(data, d => d.Year);
    const yearlyGlobalTemperature = Array.from(groupedByYear, ([Year, records]) => {
      const avgTemp = d3.mean(records, d => d.delta);
      return { Year, averageGlobalTemperature: avgTemp };
    });
    return yearlyGlobalTemperature;
  }

  // Calculate the yearly global emissions
  function calcGlobalEmission(data) {
    const groupedByYear = d3.group(data, d => d.Year);
    const yearlyGlobalEmission = Array.from(groupedByYear, ([Year, records]) => {
      const avgEmm = d3.sum(records, d => d.Total); // Change sum to mean for the mean global emissions
      return { Year, averageGlobalEmission: avgEmm };
    });
    return yearlyGlobalEmission;
  }
</script>

</html>